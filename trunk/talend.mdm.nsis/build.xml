<?xml version="1.0" encoding="UTF-8"?>
<project name="b2een" default="generate.installer">
	
	<property name="jboss.dir" value="c:/opt/jboss"/>
	<property name="tmp.dir" value="c:/tmp/nsis"/>	
	
	<target name="clean">
		<!-- clean up build directory-->
		<delete dir="build" />
		<!-- make build directory -->
		<mkdir dir="build"/>
   		<!-- clean up temporary directory -->		
		<delete dir="${tmp.dir}"/>
   		<!-- make temporary directory -->
   		<mkdir dir="${tmp.dir}"/>
	</target>
	

	<target name="generate.installer" depends="clean">	
   		<copy todir="${tmp.dir}/openMDM">
   			<fileset dir="${jboss.dir}">
   				<include name="**/*.*"/>
   				<exclude name="**/*.sh"/>
   			</fileset>
   		</copy>
		<unjar dest="${tmp.dir}/openMDM" src="src/resources/jre-1.5.0_windows.zip"></unjar>
		<!-- generate open mdm -->
		<antcall target="generate.openMDM.exe"/>
		
   		<copy todir="${tmp.dir}/openMDM">
   			<fileset dir="build">
   				<include name="*.exe"/>
   			</fileset>
   		</copy>
   		<copy todir="${tmp.dir}/openMDM">
   			<fileset dir="src/resources">
   				<include name="License.txt"/>
   			</fileset>
   		</copy>
		
		<!-- build -->
		<antcall target="make.nsis"/>
		
		<!-- final -->
		<copy todir="build">
			<fileset dir="${tmp.dir}">
			   	<include name="*.exe"/>
  			</fileset>
   		</copy>
		
	</target>
	
	<target name="make.nsis">
   		<copy todir="${tmp.dir}">
   			<fileset dir="src/scripts">
   				<include name="openMDM_installer.nsi"/>
   			</fileset>
   			<fileset dir="src/resources">
   				<include name="logo-openMDM.bmp"/>
   				<include name="mdm_installer.ico"/>
   				<include name="mdm_uninstaller.ico"/>
   			</fileset>
   		</copy>
		<!-- run make nsis -->
		<exec executable="C:/Program Files/NSIS/makensis">
			<arg value="/V4"/>
			<arg value="${tmp.dir}/openMDM_installer.nsi"/>
		</exec>
	</target>
	
	<target name="generate.openMDM.exe">
		<!-- run makensi -->
		<exec executable="C:/Program Files/NSIS/makensis">
			<arg value="src/scripts/JavaLauncher.nsi"/>
		</exec>
	</target>	
	

</project>

